<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="icon" href="/images/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <title>Dashboard Interno - Casa de Caridade 7 Raios Sagrados de Aruanda</title>
</head>

<body>
    <header>
        <a class="titulo-header" href="/">Terreiro de Umbanda</a>

        <div class="menu-hamburguer" id="menu-hamburguer">
            <i class="fas fa-bars"></i>
        </div>

        <nav class="nav-links" id="nav-links">
            <a href="/">Início</a>
            <a href="/interno/area-interna">Área Interna</a>
            <a href="/interno/pontos-interno">Pontos Internos</a>
            <a href="/interno/dashboard-interno">Dashboard</a>
        </nav>

        <a href="#" class="btn-login" onclick="sair()"><i class="fas fa-sign-out-alt"></i> Sair</a>
    </header>

    <section class="dashboard-container">
        <h1 style="text-align: center; color: #78350F; margin-bottom: 30px;">Dashboard - Gerenciamento de Calendário</h1>
        
        <div style="text-align: center; margin-bottom: 30px;">
            <button class="btn btn-marrom" onclick="mostrarFormularioEvento()">
                <i class="fas fa-plus"></i> Adicionar Evento
            </button>
        </div>

        <div id="alert-container"></div>

        <div id="formulario-container" style="display: none; max-width: 600px; margin: 0 auto 30px;">
            <div class="form-container">
                <h2 id="form-titulo">Novo Evento</h2>
                <form id="evento-form">
                    <input type="hidden" id="evento-id">
                    
                    <div class="form-group">
                        <label for="evento-titulo">Título do Evento</label>
                        <input type="text" id="evento-titulo" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="evento-data">Data</label>
                        <input type="date" id="evento-data" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="evento-horario">Horário</label>
                        <input type="time" id="evento-horario">
                    </div>
                    
                    <div class="form-group">
                        <label for="evento-local">Local</label>
                        <input type="text" id="evento-local">
                    </div>
                    
                    <div class="form-group">
                        <label for="evento-descricao">Descrição</label>
                        <textarea id="evento-descricao" rows="4"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-marrom" style="flex: 1;">Salvar</button>
                        <button type="button" class="btn btn-transparente" onclick="ocultarFormularioEvento()" style="flex: 1;">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="eventos-container">
            <!-- Eventos serão carregados aqui -->
        </div>
    </section>

    <footer class="site-footer">
        <p>© 2025 Casa de Caridade 7 Raios Sagrados de Aruanda. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/js/supabase-config.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/dashboard-interno.js"></script>
    <script>
        const menuHamburguer = document.getElementById('menu-hamburguer');
        const navLinks = document.getElementById('nav-links');

        menuHamburguer.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });

        // Verificar autenticação + permissão (somente admin)
        document.addEventListener('DOMContentLoaded', async () => {
            const estaAutenticado = await verificarAutenticacao();
            const permitido = estaAutenticado ? await verificarAdminInterno() : false;
            if (!permitido) {
                window.location.href = '/login.html';
            } else {
                carregarEventosDashboard();
            }
        });

        function mostrarFormularioEvento() {
            document.getElementById('formulario-container').style.display = 'block';
            document.getElementById('form-titulo').textContent = 'Novo Evento';
            document.getElementById('evento-form').reset();
            document.getElementById('evento-id').value = '';
        }

        function ocultarFormularioEvento() {
            document.getElementById('formulario-container').style.display = 'none';
        }

        async function sair() {
            try {
                await fazerLogout();
                window.location.href = '/login.html';
            } catch (error) {
                console.error('Erro ao fazer logout:', error);
            }
        }

        // Formulário de evento
        document.getElementById('evento-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            await salvarEvento();
        });
    </script>
</body>

</html>
